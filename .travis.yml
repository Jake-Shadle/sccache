language: rust
cache: cargo
matrix:
  include:
  - os: linux
  - os: osx
  - rust: 1.30.0
  - rust: 1.30.0
    env: DIST_SCCACHE=1
  - rust: beta
  - rust: nightly
  - env: DEPLOY=1 TARGET=x86_64-apple-darwin
    script: cargo build --release --target $TARGET --features=all
    os: osx
  - env: DEPLOY=1 TARGET=x86_64-unknown-linux-musl OPENSSL_DIR=$HOME/openssl-musl
    before_script: "./scripts/travis-musl-openssl.sh"
    script: cargo build --release --target $TARGET --features=all
    addons:
      apt:
        packages:
        - musl-tools
  allow_failures:
  - rust: nightly
before_script:
- export EXTRA_FEATURES=
- if [[ "${TRAVIS_RUST_VERSION}" = "nightly" ]]; then export EXTRA_FEATURES="$EXTRA_FEATURES
  unstable"; fi
- if [[ "${DIST_SCCACHE}" = "1" ]]; then export EXTRA_FEATURES="$EXTRA_FEATURES dist-client
  dist-server"; fi
script:
- cargo build --verbose --features="all ${EXTRA_FEATURES}"
- RUST_BACKTRACE=1 cargo test --all --verbose --no-default-features --features="${EXTRA_FEATURES}"
- RUST_BACKTRACE=1 cargo test --all --verbose --features="all ${EXTRA_FEATURES}"
before_deploy:
- "./scripts/prep_deploy.sh"

deploy:
  api_key:
    secure: GtBbHyqTw3bX8DA3zRx+5QWUC6dAVijWb0VxaR9kmXoUvFSyGyyhF7+isO5M9lqlwyAIkQ/RCDGswnYdatYZCr65BJJgm+HWqWMe7GSG9JUHETUCF4vy/hkEoTACltMQOPy0XG0vO4O7bJewPMtoZwsc9AEy69a3Rj0ZQHfsXp1Bt8dPMsvVT26yk2t1QX3011guojRfAVJy0AkDAh+wlItuyn4GxBcAYNBds5EvViOFS2kmVqGCfNLQGcNwDpIQ/RKI/vu++Cs9DPQ0V/9NzF/u0DkhwW2UgMBnqFCXAInnyHTvzuQD1QM3AXKISzpD13vD/Q2/AU13MAuTunKbZHF3oi+yfMcw8wmHi/PZZ7hNk3k7UX3nZzaY+EwocoAd/Dw5BE3t5x+RCRnAo44W75ZJpTxyWkyuVjxZZDOalgaR1CbCkKNhfe5X0FA42LEpPYj0t5vvDx5chhFBC8Dgon3bwsJH71ARmVkyKcfcXd+JXdvB1SbRf/IwBnT7VtbROf0JiescZKL1E+wPf5ACNeUKg3vMaUtAgKNENNd7XVPo2V/i/w1Ui97b59KTw1JIEZfOWYFnFkkfHPer1EiC2/oaQ5cDv0wxqfem8nntDWdSd0Glz8emLhtN0N3Xpx0iSSQ2fMBUQrS9AnP+kBTYpZmfdN+yipO+5Ms39e9fj/U=
  file:
    - sccache-$TRAVIS_TAG-$TARGET.tar.gz
    - sccache-$TRAVIS_TAG-$TARGET.tar.gz.sha256
  on:
    condition: $DEPLOY = 1
    tags: true
    repo: Jake-Shadle/sccache
  provider: releases
  skip_cleanup: true
